CREATE OR ALTER PROCEDURE insertUtilisateur (@NOM varchar, @PRENOM varchar, @ADRESSEMAIL varchar, @MOTDEPASSE varchar, @DATENAISSANCE date)
AS
BEGIN
	OPEN SYMMETRIC KEY BAMKEY256 DECRYPTION BY CERTIFICATE BOOKSANDMOVIESCERTIFICATE
	OPEN SYMMETRIC KEY BAMKEY192 DECRYPTION BY CERTIFICATE BOOKSANDMOVIESCERTIFICATE
	INSERT INTO UTILISATEUR 
	VALUES (
		GETDATE(), 
		EncryptByKey(Key_GUID('BAMKEY192'), @NOM), 
		EncryptByKey(Key_GUID('BAMKEY192'), @PRENOM),
		EncryptByKey(Key_GUID('BAMKEY192'), @ADRESSEMAIL), 
		EncryptByKey(Key_GUID('BAMKEY256'), @MOTDEPASSE),
		EncryptByKey(Key_GUID('BAMKEY192'), CONVERT(varchar, @DATENAISSANCE))
	)
	CLOSE SYMMETRIC KEY BAMKEY256
	CLOSE SYMMETRIC KEY BAMKEY192
END
GO